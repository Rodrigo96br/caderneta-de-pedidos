<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Caderneta de Pedidos</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { text-align: center; }
    .container { max-width: 900px; margin: auto; }
    .card { border: 1px solid #ccc; padding: 15px; margin-top: 20px; border-radius: 10px; }
    input, button, select { padding: 10px; margin: 5px 0; width: 100%; }
    img { width: 80px; height: 80px; object-fit: cover; border-radius: 8px; }
    .item-row { display: flex; align-items: center; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #eee; }
    .pedido-item { display: flex; justify-content: space-between; margin: 4px 0; }
    .btn { cursor: pointer; background: #007bff; color: #fff; border: none; border-radius: 8px; }
    .btn-danger { background: #d9534f; }
    .btn-success { background: #5cb85c; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Caderneta do Garçom</h1>

    <!-- Cadastro de Itens -->
    <div class="card">
      <h2>Cadastrar Item</h2>
      <input id="nomeItem" type="text" placeholder="Nome do item" />
      <input id="precoItem" type="number" placeholder="Preço" step="0.01" />
      <input id="fotoItem" type="file" accept="image/*" />
      <button class="btn" onclick="cadastrarItem()">Cadastrar</button>
    </div>

    <!-- Lista de itens cadastrados -->
    <div class="card">
      <h2>Itens Cadastrados</h2>
      <div id="listaItens"></div>
    </div>

    <!-- Fazer Pedido -->
    <div class="card">
      <h2>Adicionar ao Pedido</h2>
      <select id="selectItem"></select>
      <input id="quantidade" type="number" value="1" min="1" />
      <button class="btn-success btn" onclick="adicionarAoPedido()">Adicionar</button>

      <h3>Itens do Pedido</h3>
      <div id="pedidoAtual"></div>
      <h2>Total: R$ <span id="totalPedido">0.00</span></h2>

      <button class="btn" onclick="salvarPedido()">Salvar Pedido</button>
    </div>

    <!-- Pedidos Salvos -->
    <div class="card">
      <h2>Pedidos Salvos</h2>
      <div id="pedidosSalvos"></div>
    </div>
  </div>

  <script>
    let itens = JSON.parse(localStorage.getItem('itensGarcom') || '[]');
    let pedido = [];
    let pedidosSalvos = JSON.parse(localStorage.getItem('pedidosGarcom') || '[]');

    function atualizarListaItens() {
      const lista = document.getElementById('listaItens');
      const select = document.getElementById('selectItem');
      lista.innerHTML = '';
      select.innerHTML = '';

      itens.forEach((item, index) => {
        lista.innerHTML += `
          <div class='item-row'>
            <img src="${item.foto}" />
            <strong>${item.nome}</strong>
            <span>R$ ${item.preco}</span>
          </div>`;

        select.innerHTML += `<option value="${index}">${item.nome} - R$ ${item.preco}</option>`;
      });
    }

    function cadastrarItem() {
      const nome = document.getElementById('nomeItem').value;
      const preco = document.getElementById('precoItem').value;
      const foto = document.getElementById('fotoItem').files[0];

      if (!nome || !preco || !foto) return alert('Preencha tudo!');

      const reader = new FileReader();
      reader.onload = () => {
        itens.push({ nome, preco: parseFloat(preco).toFixed(2), foto: reader.result });
        localStorage.setItem('itensGarcom', JSON.stringify(itens));
        atualizarListaItens();
        alert('Item cadastrado!');
      };
      reader.readAsDataURL(foto);
    }

    function adicionarAoPedido() {
      const index = document.getElementById('selectItem').value;
      const qtd = parseInt(document.getElementById('quantidade').value);
      const item = itens[index];

      pedido.push({ nome: item.nome, preco: item.preco, quantidade: qtd });
      atualizarPedido();
    }

    function atualizarPedido() {
      const div = document.getElementById('pedidoAtual');
      div.innerHTML = '';

      let total = 0;
      pedido.forEach(p => {
        const subtotal = p.quantidade * parseFloat(p.preco);
        total += subtotal;
        div.innerHTML += `<div class='pedido-item'><span>${p.quantidade}x ${p.nome}</span> <span>R$ ${subtotal.toFixed(2)}</span></div>`;
      });

      document.getElementById('totalPedido').innerText = total.toFixed(2);
    }

    function salvarPedido() {
      if (pedido.length === 0) return alert('Pedido vazio!');
      pedidosSalvos.push({ itens: pedido, data: new Date().toLocaleString() });
      localStorage.setItem('pedidosGarcom', JSON.stringify(pedidosSalvos));
      pedido = [];
      atualizarPedido();
      atualizarPedidosSalvos();
      alert('Pedido salvo!');
    }

    function atualizarPedidosSalvos() {
      const div = document.getElementById('pedidosSalvos');
      div.innerHTML = '';

      pedidosSalvos.forEach((p, index) => {
        let total = 0;
        p.itens.forEach(i => total += i.quantidade * parseFloat(i.preco));

        div.innerHTML += `
          <div class='card'>
            <h3>Pedido ${index + 1} - ${p.data}</h3>
            <p>Total: R$ ${total.toFixed(2)}</p>
            <button class='btn-danger btn' onclick='excluirPedido(${index})'>Excluir</button>
          </div>`;
      });
    }

    function excluirPedido(i) {
      pedidosSalvos.splice(i, 1);
      localStorage.setItem('pedidosGarcom', JSON.stringify(pedidosSalvos));
      atualizarPedidosSalvos();
    }

    atualizarListaItens();
    atualizarPedidosSalvos();
  </script>
</body>
</html>
